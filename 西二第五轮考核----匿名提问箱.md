## 西二第五轮考核----匿名提问箱

> 项目：http://47.115.9.207:8080/  
>
> 管理员账号：administrator  321klklkl
>
> mysql账号：Littlestar  321klklkl  47.115.9.207:3306

## 项目框架

#### 后端

springboot+mybatis+shiro

#### 前端

thymeleaf模板引擎 +layui快速开发框架



## 实现功能

> 在基础所有功能上额外实现了站内消息功能

#### **注册：**

- 要求用户名为1~10位，不允许重复

- 注册需要邮箱，通过邮箱接收激活码，绑定邮箱后才能成功注册，邮箱要求唯一

- 密码需要通过强度验证，要求有大写字母、小写字母、数字、其他字符中的两项才允许注册

#### 登录：

- 使用用户名和邮箱都可以登录

##### PS:表单中密码均通过hash传输，且各项数据都有有效性验证



#### 密码重置：

- 登录界面上面点击忘记密码进入密码重置页面
- 要求用户输入自己的注册邮箱，若注册邮箱有在系统上登记，则向邮箱发送重置密码链接
- 通过重置密码链接到达重置密码页面，输入新密码完成修改密码

##### PS:用户的每一次请求都会从数据库里重新读取信息存放至session，并通过拦截器检验，若检测到密码与session中不一致，则强制退出

#### 用户资料管理：

- 在用户个人主页可以查看用户资料，并可以进入修改页面
- 修改用户名要求**唯一性**
- 修改邮箱需要输入正确的密码，密码正确后通过**邮箱激活码**绑定新的邮箱
- 在修改邮箱后账号需要**重新激活**
- 上传头像时不允许非图片文件上传，上传的大小也不允许超过10MB
- 修改密码要求提供原密码
- 输入新密码时要求两次输入相同，同样有密码强度验证

##### PS:由于绑定邮箱需要邮箱激活码验证，故不存在输错邮箱的情况，邮箱也有唯一性验证。上传文件名会放在该用户编号命名的文件夹下，文件名为上传的时间戳。

#### 提问箱：

- 提问箱的状态默认为关闭，验证邮箱后可手动开启

- 提问和接受提问都需要双方提问箱都处于开启状态

- 不能向对方发送提问的几种情况：

  1. 账户处于封禁状态或未激活
  2. 账户被对方拉黑
  3. 对方不开放提问箱（也就是不接受任何提问），则也不能向对方发起提问。

- 提问方式为**匿名**，被提问者看不到提问者的名字，只能看见内容

- 允许被提问者对提问进行**删除**、**回复**、**举报**、**拉黑**功能（拉黑和举报的同时将该用户写入黑名单）

- 个人主页可以查看**已回复的提问**、**未回复的提问**、**已删除的提问**、**已被回复的提问**、**未被回复的提问**、**已被删除的提问** (删除为假删除，即数据库中deleted标记，删除可以取消)

  

  ##### PS:个人认为不应该允许拉黑取消，否则用户可以通过反复测试知道提问者的名字，与匿名性相悖。

### 网站管理

- 举报管理中心可以处理用户的举报（对被举报人封禁，也可以不进行任何操作）
- 用户总览页面显示每个用户的**激活状态**、**封禁状态**、**提问箱的问题数**、**提问的数量**、**回复提问的数量**
- 可以根据用户名或是邮箱查找用户，对用户进行封禁/解封，查看这个用户的数据（所有收到的提问、回复的提问、发起的提问等）
- 可以发布公告

### 站内消息

- 有新公告、提问收到了回复、被封禁/解封了、账户激活成功将会接收到一条站内消息
- 站内消息是默认是未读状态，阅读后标记为已读。

### 





## 安全问题

### XSS:

通过过滤器将表单输入的‘**<**   **>**转义，从而防范XSS

### CSRF:

用户登录成功后生成**随机token**，在整个使用过程中，每次用post进行提交都需要验证token，且每次请求结束后token都会**随机重置**

### 密码安全：

密文传输时，先由表单进行hash加盐加密后传至后端，后端再进行一次hash加盐，由于他人不知道加盐方式，也不知道加盐次数，故无法破解密码

### 接口安全：

密码重置和激活的接口为/xx/xx/username,username为该用户的hash加盐后的密文，他人不知道加密方式，破解难度较大

### 匿名性：

前后端数据传递过程中均无提问者姓名出现

### 账号安全：

用户在访问过程中，每申请一次请求都会从数据库里读取数据刷新session。当用户发现自己账号被盗后，可通过绑定的邮箱重置密码。而非法用户再次发起请求时，由于session中的密码和数据库不一致，将会被拦截器踢下线。



### 一些个人认为的亮点

- 项目分层结构清晰，代码可维护性较强
- 使用了大量的状态码作为项目过程中的状态反馈（虽然有点乱）
- 功能较为齐全，用户界面较为友好（写js的时间都快超过java了）



### 不足：

- 由于时间原因，安全性做的还不够完善
- 数据库有些冗杂，sql语句不过熟练，写的有点乱
- 前端功底太薄弱，各组件位置摆放的不大对（可能会出现按钮乱飞的情况，请见谅）
